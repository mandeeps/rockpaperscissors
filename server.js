// Generated by CoffeeScript 1.6.3
(function() {
  var app, db, express, mongoose;

  express = require('express');

  app = express();

  mongoose = require('mongoose');

  mongoose.connect('mongodb://127.0.0.1:27017/rps');

  app.configure(function() {
    app.use(express["static"](__dirname + '/public'));
    app.use(express.logger('dev'));
    app.use(express.bodyParser());
    return app.use(express.methodOverride());
  });

  db = mongoose.connection;

  db.on('error', console.error.bind(console, 'connection error:'));

  db.once('open', function() {
    var Player;
    Player = mongoose.model('Player', {
      name: String
    });
    app.get('/api/players', function(req, res) {
      return Player.find(function(err, players) {
        if (err) {
          res.send(err);
        }
        return res.json(players);
      });
    });
    app.post('/api/players', function(req, res) {
      Player.create({
        name: req.body.name,
        done: false
      }, function(err, player) {
        if (err) {
          res.send(err);
        }
        return Player.find(function(err, players) {
          if (err) {
            res.send(err);
          }
          return res.send(players);
        });
      });
      return console.log(req.body.name);
    });
    app["delete"]('/api/players/:player_id', function(req, res) {
      Player.remove({
        _id: req.params.player_id
      });
      (function(err, player) {
        if (err) {
          return res.send(err);
        }
      });
      return Player.find(function(err, players) {
        if (err) {
          res.send(err);
        }
        return res.json(players);
      });
    });
    app.listen(8080);
    return console.log('running on 8080');
  });

}).call(this);
